# 更新日志 (Changelog)

## [未发布] - 2025-11-04

### 修复
- **修复 AudioContext 自动播放策略问题**
  - 问题：浏览器要求 AudioContext 必须在用户交互后才能启动，直接加载页面会报错
  - 解决方案：
    - 将初始化流程分为两个阶段：
      1. 页面加载时只加载 AI 模型（不创建 AudioContext）
      2. 用户点击"开始游戏"按钮后才初始化游戏组件和 AudioContext
    - 添加"开始游戏"按钮，等待用户交互
    - 游戏启动后按钮变为"重新开始"，允许用户重新开始游戏
  - 影响文件：
    - `index.html` - 修改按钮显示逻辑
    - `js/main.js` - 重构初始化流程

### 优化
- **调整音乐和舞蹈速度上限**
  - 音乐播放速度：最大 2 倍（之前是 10 倍）
  - 舞蹈速度：最大 10 倍（保持不变）
  - 速度映射：当舞蹈速度达到 5 倍时，音乐速度达到 2 倍上限
  - 原因：音乐速度过快会影响体验，2 倍速度更合理
  - 影响文件：
    - `js/main.js` - MP3Player 初始化参数
    - `js/game.js` - 速度映射逻辑

- **移除合成音效**
  - 移除了"咚咚咚"的合成背景音乐
  - 移除了鼓掌反馈的合成音效
  - 原因：使用 MP3 音乐播放器代替，音质更好
  - 影响文件：
    - `js/game.js` - 注释掉 `playBackgroundMusic()` 中的合成音乐代码
    - `js/main.js` - 注释掉 `playFeedback()` 中的合成音效代码

### 技术细节
- **AudioContext 初始化时机**
  - 之前：页面加载时立即创建 AudioContext → 浏览器阻止 → 报错
  - 现在：用户点击按钮后创建 AudioContext → 符合浏览器策略 → 正常工作

- **初始化流程**
  ```
  页面加载
    ↓
  loadModel() - 加载 AI 模型
    ↓
  显示"开始游戏"按钮
    ↓
  用户点击按钮
    ↓
  initAndStartGame() - 初始化游戏组件
    ↓
  创建 AudioContext (MP3Player)
    ↓
  startGame() - 启动游戏
  ```

### 测试
- ✅ 页面加载无 AudioContext 错误
- ✅ 点击"开始游戏"后正常启动
- ✅ MP3 音乐正常播放
- ✅ 音频识别正常工作
- ✅ 进度条正常显示
- ✅ 速度映射正确（舞蹈 5x → 音乐 2x）
- ✅ 无合成音效干扰

---

## 历史版本

### [1.0.0] - 初始版本
- 基础功能实现
- 音频识别（Teachable Machine）
- 舞蹈动画（Phaser.js）
- 鼓掌强度计算
- MP3 音乐播放
- 实时进度条显示

